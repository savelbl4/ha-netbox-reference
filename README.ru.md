# HA NetBox (–±–µ–∑ Kubernetes)

üá¨üáß **English version:** [README.md](README.md)

> –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ NetBox –Ω–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

---

## –ß—Ç–æ —ç—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é HA-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é NetBox** –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Kubernetes.

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî **–Ω–µ** ¬´—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π¬ª, –∞ –ø–æ–∫–∞–∑:
- –∫–∞–∫ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å NetBox –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–º,
- –∫–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã,
- —Å –∫–∞–∫–∏–º–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—ë—Ç–µ—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.

–ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–ª—Å—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∫–∞–∫ **—Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞**, –∞ –Ω–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π —Å—Ç–µ–Ω–¥.

---

## –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞:
- —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö NetBox –∫–∞–∫ Source of Truth
- –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∏ DevOps-–∏–Ω–∂–µ–Ω–µ—Ä–æ–≤
- SRE –≤ on‚Äëprem / VM‚Äë—Å—Ä–µ–¥–∞—Ö

–û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–Ω–∏–º–∞–Ω–∏–µ:
- Linux
- –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ PostgreSQL
- —Å–µ—Ç–µ–≤—ã—Ö –∏ HA‚Äë–∫–æ–Ω—Ü–µ–ø—Ü–∏–π

---

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç

- –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç NetBox –≤ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç HA PostgreSQL —Å –ø–æ–º–æ—â—å—é Patroni + etcd
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –≤ HA‚Äë—Ä–µ–∂–∏–º–µ
- –†–µ–∞–ª–∏–∑—É–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –∏ failover —á–µ—Ä–µ–∑ VIP
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –≥—Ä–∞–±–ª–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

## –ß–µ–≥–æ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ù–ï –¥–µ–ª–∞–µ—Ç

- ‚ùå –≠—Ç–æ –Ω–µ managed‚Äë—Å–µ—Ä–≤–∏—Å
- ‚ùå –≠—Ç–æ –Ω–µ ¬´–æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞¬ª
- ‚ùå –≠—Ç–æ –Ω–µ Kubernetes
- ‚ùå –≠—Ç–æ –Ω–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç **–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –∑–Ω–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞**.

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- –ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ NetBox (web + workers)
- –ö–ª–∞—Å—Ç–µ—Ä PostgreSQL —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º failover (Patroni)
- Redis HA
- HAProxy + Virtual IP (Keepalived)
- Ansible –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

–ê–Ω–∞–ª–æ–≥–∏—è:
> NetBox –≤ —ç—Ç–æ–π —Å—Ö–µ–º–µ ‚Äî —ç—Ç–æ control‚Äëplane, –∫–∞–∫ —É —Å–µ—Ç–µ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

```text
<ASCII-—Å—Ö–µ–º–∞>
                    Users / Automation
                  (Engineers, CI/CD, API)
                            |
                            v
                +--------------------------------+
                |        Virtual IP (VIP)        |
                |   HAProxy + Keepalived (HA)    |
                +--------------------------------+
                            |
          -------------------------------------------------
          |                       |                       |
          v                       v                       v
+----------------+     +----------------+     +----------------+
|    NetBox #1   |     |    NetBox #2   |     |    NetBox #3   |
|  Web + Workers |     |  Web + Workers |     |  Web + Workers |
|   (stateless)  |     |   (stateless)  |     |   (stateless)  |
+----------------+     +----------------+     +----------------+
          |                       |                       |
          +-----------+-----------+-----------+-----------+
                      |                       |
                      v                       v

        ======================        ======================
        =  PostgreSQL Cluster =        =     Redis HA     =
        ======================        ======================
        +------------+               +------------+
        | Postgres 1 |<---- Leader   |  Redis 1   |  Master
        +------------+               +------------+
        | Postgres 2 |  Replica      |  Redis 2   |  Replica
        +------------+               +------------+
        | Postgres 3 |  Replica      |  Redis 3   |  Replica
        +------------+               +------------+
               |
            Patroni
               |
              etcd
          (quorum / leader election)

```

---

## –ü–æ—á–µ–º—É –±–µ–∑ Kubernetes

–≠—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

–ü—Ä–∏—á–∏–Ω—ã:
- –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ç–∫–∞–∑–æ–≤
- –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–∞—è –æ—Ç–ª–∞–¥–∫–∞
- –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è on‚Äëprem –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –∫–æ–º–∞–Ω–¥

---

## –ü–æ–¥—Ö–æ–¥ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: **Ansible**
- –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤:
  - pre‚Äëstart
  - bootstrap
  - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ–ø–ª–æ–π
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è **–æ–ø–∏—Å–∞–Ω—ã –≤—Ä—É—á–Ω—É—é**, –∞ –Ω–µ —Å–ø—Ä—è—Ç–∞–Ω—ã

> –ù–µ –≤—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ª—é–±–æ–π —Ü–µ–Ω–æ–π.

---

## –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:
- –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –≥—Ä–∞–±–ª–∏
- —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É backup –∏ recovery
- —Ä—É—á–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –≤—ã–≤–æ–¥—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

–≠—Ç–æ **—á–∞—Å—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞**, –∞ –Ω–µ –µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫.

---

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

- –¢–∏–ø: reference / showcase
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ –ø–æ–¥—Ö–æ–¥—ã
- –ë–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
