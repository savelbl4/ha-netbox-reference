import ldap
from django_auth_ldap.config import LDAPSearch, NestedGroupOfNamesType

AUTH_LDAP_SERVER_URI = "{{ ldap_backend.uri }}"

AUTH_LDAP_CONNECTION_OPTIONS = {
    ldap.OPT_REFERRALS: 0
}

AUTH_LDAP_BIND_DN = "CN=svc-netbox,OU=SVC,DC=demo,DC=rubytech,DC=ru"
AUTH_LDAP_BIND_PASSWORD = "{{ ldap_backend.password }}"

LDAP_IGNORE_CERT_ERRORS = False

LDAP_CA_CERT_DIR = '/etc/ssl/certs'

LDAP_CA_CERT_FILE = '/path/to/example-CA.crt'

AUTH_LDAP_USER_SEARCH = LDAPSearch(
    "DC=demo,DC=rubytech,DC=ru",
    ldap.SCOPE_SUBTREE,
    "(|(userPrincipalName=%(user)s)(sAMAccountName=%(user)s))"
)

AUTH_LDAP_USER_DN_TEMPLATE = None

AUTH_LDAP_USER_ATTR_MAP = {
    "username": "sAMAccountName",
    "email": "mail",
    "first_name": "givenName",
    "last_name": "sn",
}

AUTH_LDAP_USER_QUERY_FIELD = "username"

AUTH_LDAP_GROUP_SEARCH = LDAPSearch(
    "DC=demo,DC=rubytech,DC=ru",
    ldap.SCOPE_SUBTREE,
    "(objectClass=group)"
)
AUTH_LDAP_GROUP_TYPE = NestedGroupOfNamesType()


AUTH_LDAP_MIRROR_GROUPS = True
AUTH_LDAP_ALWAYS_UPDATE_USER = True
AUTH_LDAP_USER_FLAGS_BY_GROUP = {
        "is_active": "cn=netbox-active,ou=Access-Groups,dc=demo,dc=rubytech,dc=ru",
        "is_staff": "cn=netbox-staff,ou=Access-Groups,dc=demo,dc=rubytech,dc=ru",
        "is_superuser": "cn=netbox-admins,ou=Access-Groups,dc=demo,dc=rubytech,dc=ru"
}

AUTH_LDAP_FIND_GROUP_PERMS = True

AUTH_LDAP_CACHE_TIMEOUT = 3600